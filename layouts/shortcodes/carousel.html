<figure class="carousel" id="{{ .Get "id" }}">
    {{ $imagesParam := .Get "images" }}
    {{ $captionsParam := .Get "captions" }}
    {{ $images := split $imagesParam "," }}
    {{ $captions := split $captionsParam "|" }}

    <div class="carousel-inner">
        {{ range $index, $image := $images }}
        <div class="carousel-item{{ if eq $index 0 }} active{{ end }}">
            <img src="{{ $image }}" alt="{{ index $captions $index }}">
            <figcaption>{{ index $captions $index }}</figcaption>
        </div>
        {{ end }}
    </div>

    <!-- Кнопки пролистывания -->
    <div class="carousel-controls">
        <button type="button" class="carousel-control-prev">
            <span>&lt;</span>
        </button>
        <button type="button" class="carousel-control-next">
            <span>&gt;</span>
        </button>
    </div>
</figure>

<script>
    $(document).ready(function(){
        var carouselID = "#{{ .Get "id" }}";
        var $carousel = $(carouselID + ' .carousel-inner');
        var $captions = $(carouselID + ' figcaption');
        var totalSlides = $carousel.children().length;
        var currentSlide = 0;

        // Показать первую подпись
        $captions.eq(0).addClass('active');

        // Функция для обновления подписи
        function updateCaption(index) {
            $captions.removeClass('active');
            $captions.eq(index).addClass('active');
        }

        // Пролистывание карусели
        function goToSlide(index) {
            if (index >= 0 && index < totalSlides) {
                $carousel.children().removeClass('active');
                $carousel.children().eq(index).addClass('active');
                updateCaption(index);
                currentSlide = index;
            } else if (index < 0) {
                goToSlide(totalSlides - 1); // Переход на последний слайд
            } else if (index >= totalSlides) {
                goToSlide(0); // Переход на первый слайд
            }
        }

        // Клик на кнопку "назад"
        $(carouselID + ' .carousel-control-prev').click(function(){
            goToSlide(currentSlide - 1);
        });

        // Клик на кнопку "вперед"
        $(carouselID + ' .carousel-control-next').click(function(){
            goToSlide(currentSlide + 1);
        });

        // Плавный переход между слайдами
        $carousel.children().css('transition', 'transform 0.5s ease-in-out');

        // Свайп для мобильных устройств (без использования библиотеки swipe)
        $carousel.on('touchstart', function(event){
            var xClick = event.originalEvent.touches[0].pageX;
            $carousel.one('touchmove', function(event){
                var xMove = event.originalEvent.touches[0].pageX;
                if (Math.floor(xClick - xMove) > 5){
                    goToSlide(currentSlide + 1);
                }
                else if (Math.floor(xClick - xMove) < -5){
                    goToSlide(currentSlide - 1);
                }
            });
            $carousel.on('touchend', function(){
                $carousel.off('touchmove');
            });
        });
    });
</script>

<style>
    .carousel {
        position: relative;
        width: 100%;
        max-width: 760px;
        margin: 0 auto;
    }

    .carousel-inner {
        position: relative;
        width: 100%;
        overflow: hidden;
        display: flex;
        transition: transform 0.5s ease-in-out;
    }

    .carousel-item {
        min-width: 100%;
        box-sizing: border-box;
        text-align: center;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }

    .carousel-item.active {
        opacity: 1;
    }

    .carousel-item img {
        max-width: 100%;
        height: auto;
    }

    figcaption {
        padding: 8px;
        color: black;
        text-align: center;
    }

    .carousel-controls {
        position: absolute;
        top: 50%;
        width: 100%;
        display: flex;
        justify-content: space-between;
        transform: translateY(-50%);
        pointer-events: none;
    }

    .carousel-control-prev, .carousel-control-next {
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
        pointer-events: all;
        border-radius: 50%;
        background-color: rgba(200, 200, 200, 0.5);
    }

    .carousel-control-prev:hover, .carousel-control-next:hover {
        background-color: rgba(200, 200, 200, 0.8);
    }

    .carousel-control-prev span, .carousel-control-next span {
        font-size: 2rem;
        color: rgba(0, 0, 0, 0.5);
    }

    .carousel-controls .carousel-control-prev {
        left: 10px;
    }

    .carousel-controls .carousel-control-next {
        right: 10px;
    }
</style>
